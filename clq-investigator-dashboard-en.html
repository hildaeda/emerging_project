<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jabatan Tenaga Kerja Semenanjung Malaysia (JTKSM) ‚Äì Risk-Based Central Labour Quarters Investigation Portal (Prototype)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- Top Navigation -->
  <header class="bg-white shadow flex items-center justify-between px-6 py-3">
    <div class="flex items-center space-x-2">
      <img src="./jata-negara.png" alt="Coat of Arms of Malaysia" style="height:60px;width:60px;object-fit:contain;border-radius:60%;background:#fff;padding:4px;" />
      <div>
        <h1 class="text-lg font-semibold text-gray-800">
          Jabatan Tenaga Kerja Semenanjung Malaysia (JTKSM) ‚Äì Risk-Based Central Labour Quarters Investigation Portal
        </h1>
        <p class="text-xs text-gray-500">Prototype ‚Äì For Demonstration Purposes Only</p>
      </div>
    </div>

    <div class="flex items-center space-x-4">
      <button class="relative" aria-label="Notifications">
        <span class="text-gray-500">üîî</span>
        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center">3</span>
      </button>

      <div class="flex items-center space-x-2">
        <img src="./investigator.png" alt="Coat of Arms of Malaysia" style="height:60px;width:60px;object-fit:contain;border-radius:60%;background:#fff;padding:4px;" />
        <div class="text-sm">
          <p class="font-medium text-gray-800">Aina binti Ahmad</p>
          <p class="text-xs text-gray-500">Investigator Officer</p>
        </div>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-60 bg-white border-r min-h-screen">
      <nav class="mt-4">
        <a href="#"
           class="flex items-center px-5 py-2 text-sm font-medium text-blue-600 bg-blue-50 border-l-4 border-blue-600">
          Dashboard
        </a>
        <a href="#"
           class="flex items-center px-5 py-2 text-sm text-gray-600 hover:bg-gray-50">
          CLQ List
        </a>
        <a href="#"
           class="flex items-center px-5 py-2 text-sm text-gray-600 hover:bg-gray-50">
          Worker Complaints
        </a>
        <a href="#"
           class="flex items-center px-5 py-2 text-sm text-gray-600 hover:bg-gray-50">
          Reports & Analytics
        </a>
        <a href="#"
           class="flex items-center px-5 py-2 text-sm text-gray-600 hover:bg-gray-50">
          Settings
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 space-y-6">
      <!-- Title + Filters -->
      <section class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h2 class="text-xl font-semibold text-gray-800">
            Risk-Based Investigation Dashboard ‚Äì CLQ
          </h2>
          <p class="text-sm text-gray-500">
            Predictive signals help prioritise CLQs for investigation under Act 446. Final decisions remain with officers.
          </p>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <select id="filterState"
                  class="border border-gray-300 text-sm rounded px-2 py-1 bg-white">
            <option value="">All States</option>
            <option value="JOHOR">JOHOR</option>
            <option value="SELANGOR">SELANGOR</option>
            <option value="KEDAH">KEDAH</option>
            <option value="PULAU PINANG">PULAU PINANG</option>
          </select>

          <select id="filterRisk"
                  class="border border-gray-300 text-sm rounded px-2 py-1 bg-white">
            <option value="">All Risk Levels</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>

          <button id="btnApplyFilter"
                  class="bg-blue-600 text-white text-sm px-4 py-1.5 rounded shadow hover:bg-blue-700">
            Generate Priority List
          </button>
        </div>
      </section>

      <!-- Summary Cards -->
      <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-lg shadow-sm p-4">
          <p class="text-xs text-gray-500 uppercase">Registered CLQs</p>
          <p id="cardTotalClq" class="mt-2 text-2xl font-semibold text-gray-800">-</p>
          <p class="text-xs text-gray-400">In the current view</p>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-4">
          <p class="text-xs text-gray-500 uppercase">High-Risk CLQs</p>
          <p id="cardHighRisk" class="mt-2 text-2xl font-semibold text-red-600">-</p>
          <p class="text-xs text-gray-400">Flagged by predictive signals</p>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-4">
          <p class="text-xs text-gray-500 uppercase">Investigations Scheduled</p>
          <p class="mt-2 text-2xl font-semibold text-gray-800">18</p>
          <p class="text-xs text-gray-400">December 2025</p>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-4">
          <p class="text-xs text-gray-500 uppercase">Complaints (Last 60 Days)</p>
          <p id="cardComplaints" class="mt-2 text-2xl font-semibold text-orange-500">-</p>
          <p class="text-xs text-gray-400">Related to worker accommodation</p>
        </div>
      </section>

      <!-- Table + Detail Panel -->
      <section class="grid grid-cols-1 xl:grid-cols-3 gap-4">
        <!-- Table -->
        <div class="xl:col-span-2 bg-white rounded-lg shadow-sm p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-semibold text-gray-800">
              Investigation Priority List<br>
		<font class="text-xs text-gray-400">*Risk scores are produced by a simplified predictive scoring model for decision support.</font>
            </h3>
            <!-- <p class="text-xs text-gray-400">
              *Risk scores are produced by a simplified predictive scoring model for decision support.
            </p>-->
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full text-xs md:text-sm border-t border-gray-100">
              <thead class="bg-gray-50 text-gray-600">
                <tr>
                  <th class="px-3 py-2 text-left">#</th>
                  <th class="px-3 py-2 text-left">CLQ Name</th>
                  <th class="px-3 py-2 text-left">State</th>
                  <th class="px-3 py-2 text-right">Score</th>
                  <th class="px-3 py-2 text-center">Risk Level</th>
                  <th class="px-3 py-2 text-center">Action</th>
                </tr>
              </thead>
              <tbody id="clqTableBody" class="divide-y divide-gray-100">
                <!-- rows injected -->
              </tbody>	 
            </table>
			<div class="flex items-center justify-between mt-4">
			  <div class="text-sm text-gray-500" id="pagingInfo">
				Showing - to - of -
			  </div>

			  <div class="flex items-center gap-2">
				<button id="btnPrev"
				  class="px-3 py-1.5 text-sm rounded border bg-white hover:bg-gray-50 disabled:opacity-50"
				  disabled>
				  Prev
				</button>

				<select id="pageSize"
				  class="border rounded px-2 py-1 text-sm bg-white">
				  <option value="5">5 / page</option>
				  <option value="10" selected>10 / page</option>
				  <option value="20">20 / page</option>
				</select>

				<button id="btnNext"
				  class="px-3 py-1.5 text-sm rounded border bg-white hover:bg-gray-50">
				  Next
				</button>
			  </div>
			</div>			  			
          </div>
        </div>

        <!-- Detail Panel -->
        <div class="bg-white rounded-lg shadow-sm p-4 space-y-3">
          <h3 class="text-sm font-semibold text-gray-800 mb-1">CLQ Risk Profile</h3>
          <p class="text-xs text-gray-500 mb-3">
            Click <span class="font-semibold">‚ÄúView‚Äù</span> in the list to see risk details and recommended actions.
          </p>

          <div class="border rounded-lg p-3 bg-gray-50">
            <p class="text-xs text-gray-500">CLQ Name</p>
            <p id="detailName" class="text-sm font-semibold text-gray-800">-</p>
            <!-- <p id="detailEmployer" class="text-xs text-gray-500">Operator/Employer: -</p> -->
            <p id="detailState" class="text-xs text-gray-500">State: -</p>

            <div class="mt-2 flex items-center space-x-2">
              <span id="detailRiskBadge"
                    class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-gray-200 text-gray-700">
                RISK LEVEL
              </span>
              <span id="detailRiskScore" class="text-xs text-gray-500">Risk Score: -</span>
            </div>
          </div>

          <div class="border rounded-lg p-3">
            <p class="text-xs font-semibold text-gray-700 mb-2">Risk Score Breakdown (Model Contribution)</p>
            <ul id="detailBreakdown" class="text-xs text-gray-600 space-y-1">
              <li>-</li>
            </ul>
          </div>

          <div class="border rounded-lg p-3">
            <p class="text-xs font-semibold text-gray-700 mb-2">Key Signals</p>
            <ul id="detailSignals" class="text-xs text-gray-600 space-y-1">
              <li>-</li>
            </ul>
          </div>

          <div class="border rounded-lg p-3">
            <p class="text-xs font-semibold text-gray-700 mb-2">Recommended Action</p>
            <p id="detailRecommendation" class="text-xs text-gray-600 mb-3">-</p>

            <div class="flex flex-wrap gap-2">
              <button class="bg-blue-600 text-white text-xs px-3 py-1 rounded hover:bg-blue-700">
                Schedule Investigation
              </button>
              <button class="bg-orange-500 text-white text-xs px-3 py-1 rounded hover:bg-orange-600">
                Issue Compliance Notice
              </button>
            </div>
          </div>

          <div class="text-[11px] text-gray-500">
            Note: Risk scoring supports prioritisation. Enforcement actions require officer verification.
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Sample dataset (mock)
// 1) Paste CSV here (replace content only)
const registryCsv = `
clqName,certificateNo,registrationNo,address,state,district,certificateIssuedDate,certificateExpiryDate,complaints60d,pastViolations,daysSinceLastInspection
UNIVERSAL BEST SDN BHD,PAC/10202/2022/61583,313534M,"LOT 3329, 3330 JALAN BAKAR SAMPAH - PATANI PARA  08000 SUNGAI PETANI KUALA MUDA KEDAH",KEDAH,KUALA MUDA,6-Jul-22,6-Jul-25,1,0,27
METRO EXCEL RESOURCES SDN BHD,PAC/11004/2021/54363,639802A,SAVANNA EXECUTIVE SUITES JALAN BBLS 2 BANDAR BARU LEMBAH SELATAN 43800 DENGKIL SEPANG SELANGOR,SELANGOR,SEPANG,7-Jul-22,7-Jul-25,10,0,645
YANJIAN GROUP CONSTRUCTIONS (M) SDN BHD,PAC/11004/2022/56696,989976V,"PT 56028, WARISAN PUTERI KOTA WARISAN, SEPANG  43900 SEPANG SEPANG SELANGOR",SELANGOR,SEPANG,7-Jul-22,7-Jul-25,12,0,188
METRO EXCEL RESOURCES SDN BHD,PAC/11004/2022/60418,639802A,"VISTA BANGI SERVICE APARTMENT, LOT 2113, BT 18, JALAN REKO 43000 KAJANG HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,7-Jul-22,7-Jul-25,0,0,95
RITZ CLEANING SERVICES SDN BHD,PAC/10801/2022/60352,956572U,13 PERSIARAN HALAMAN AMPANG 14 TAMAN IPOH JAYA TIMUR  31350 IPOH KINTA PERAK,PERAK,KINTA,13-Jul-22,13-Jul-25,8,0,86
TEO AH POH,PAC/10104/2022/63312,6.31021E+11,"NO.12,TINGKAT 1,JALAN BESAR,TANGKAK 84900 TANGKAK,JOHOR.  84900 TANGKAK TANGKAK/LEDANG JOHOR",JOHOR,TANGKAK/LEDANG,17-Jul-22,17-Jul-25,0,0,340
TOPNOTCH SOLUTIONS SDN. BHD.,PAC/11004/2022/62393,825871V,"106, Blok C, Jalan 6C/2   43650 BDR BARU BANGI HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,19-Jul-22,19-Jul-25,3,10,190
TOPNOTCH SOLUTIONS SDN. BHD.,PAC/11004/2022/62394,825871V,"503, BLOK 1, JALAN 6C/11   43650 BDR BARU BANGI HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,19-Jul-22,19-Jul-25,0,0,34
TOPNOTCH SOLUTIONS SDN. BHD.,PAC/11004/2022/62395,825871V,"112, BLOK A, JALAN 6/2   43650 BDR BARU BANGI HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,19-Jul-22,19-Jul-25,5,2,212
MEL FORCE ENTERPRISE SDN BHD,PAC/11002/2022/62960,674917U,"M2-G-12, APARTMENT SRI BAYU, SOLOK SUNGAI CHANDONG/KS11, BANDAR ARMADA PUTRA 42920 PELABUHAN KLANG 42920 PELABOHAN KLANG KLANG SELANGOR",SELANGOR,KLANG,19-Jul-22,19-Jul-25,2,0,10
MEL FORCE ENTERPRISE SDN BHD,PAC/11002/2022/62956,674917U,"M2-G-9, APARTMENT SRI BAYU, SOLOK SUNGAI CHANDONG/KS11, BANDAR ARMADA PUTRA 42920 PELABUHAN KLANG 42920 PELABOHAN KLANG KLANG SELANGOR",SELANGOR,KLANG,19-Jul-22,19-Jul-25,5,0,181
LEE HARTA SDN BHD,PAC/11003/2022/63860,2.01301E+11,"Lot PT 1372, Jalan Kesidang 5 Kawasan Industrian Sg Choh  48000 RAWANG GOMBAK SELANGOR",WILAYAH PERSEKUTUAN KUALA LUMPUR,GOMBAK,19-Jul-22,19-Jul-25,10,1,33
HARMONY DORMITORY SDN BHD,PAC/10702/2022/63711,2.02201E+11,"23 units, Taman Telok Molek, Telok Air Tawar, 13050 Butterworth , Pulau Pinang   13050 BUTTERWORTH DAERAH UTARA PULAU PINANG",PULAU PINANG,DAERAH UTARA,20-Jul-22,20-Jul-25,6,0,81
LSH Best Builder Sdn Bhd,PAC/11401/2022/62898,564259P,Sentul Rumawip Jalan Sentul Pasar  53000 KUALA LUMPUR KUALA LUMPUR WP KUALA LUMPUR,WILAYAH PERSEKUTUAN KUALA LUMPUR,KUALA LUMPUR,29-Jul-22,29-Jul-25,2,1,20
UNIVERSAL BEST SDN BHD,PAC/10202/2021/52813,313534M,"E-345,E-335 &E-340 LORONG 24,E-311 & E-305 LORONG 25,E-109,E-128,E-125,E-264,E-265 & E-266 LORONG 26,E-97,E-102 & E-90 JALAN INDAH 2 TAMAN SEJATI INDAH  08000 SUNGAI PETANI KUALA MUDA KEDAH",KEDAH,KUALA MUDA,3-Aug-22,3-Aug-25,0,2,106
UNIVERSAL BEST SDN BHD,PAC/10202/2021/53121,313534M,"E-360, E-377 & E-380 LORONG 23, E-405 JALAN INDAH 7 TAMAN SEJATI INDAH  08000 SUNGAI PETANI KUALA MUDA KEDAH",KEDAH,KUALA MUDA,3-Aug-22,3-Aug-25,0,0,228
UNIVERSAL BEST SDN BHD,PAC/10202/2021/53132,313534M,D-309 & D-310 LORONG 19 TAMAN SEJATI INDAH  08000 SUNGAI PETANI KUALA MUDA KEDAH,KEDAH,KUALA MUDA,3-Aug-22,3-Aug-25,1,2,234
PARAMOUNT CONSTRUCTION SDN BHD,PAC/10202/2021/12330,277548D,"LOT 5961,BANDAR AMANJAYA ,MUKIM SUNGAI PETANI, DAERAH KUALA MUDA   08000 SUNGAI PETANI KUALA MUDA KEDAH",KEDAH,KUALA MUDA,3-Aug-22,3-Aug-25,3,2,9
DESTINY UNIQUE SDN. BHD.,PAC/10401/2022/63553,1426770T,"A-G-13, A-G-14, A-G-15, A-G-16, A-01-13, A-01-14, A-01-15, A-01-16, A-02-13, A-02-14, BLOK A, PANGSAPURI BUKIT BERUANG BUKIT BERUANG 75450 AYER KEROH MELAKA TENGAH MELAKA",MELAKA,MELAKA TENGAH,9-Aug-22,9-Aug-25,6,10,720
SOUTHERN SOLUTION SERVICES,PAC/10101/2022/63651,JM0454511P,"NO.8A, JALAN BELADAU 3, TAMAN PUTERI WANGSA, 81800 ULU TIRAM, JOHOR.   81800 ULU TIRAM JOHOR BAHRU JOHOR",JOHOR,JOHOR BAHRU,10-Aug-22,10-Aug-25,0,0,125
SOUTHERN SOLUTION SERVICES,PAC/10101/2022/63658,JM0454511P,"NO.8B, JALAN BELADAU 3, TAMAN PUTERI WANGSA, 81800 ULU TIRAM, JOHOR.   81800 ULU TIRAM JOHOR BAHRU JOHOR",JOHOR,JOHOR BAHRU,10-Aug-22,10-Aug-25,0,0,37
SOUTHERN SOLUTION SERVICES,PAC/10101/2022/63659,JM0454511P,"NO.10A, JALAN BELADAU 3, TAMAN PUTERI WANGSA, 81800 ULU TIRAM, JOHOR.   81800 ULU TIRAM JOHOR BAHRU JOHOR",JOHOR,JOHOR BAHRU,10-Aug-22,10-Aug-25,2,0,114
SOUTHERN SOLUTION SERVICES,PAC/10101/2022/63661,JM0454511P,"NO.10B, JALAN BELADAU 3, TAMAN PUTERI WANGSA, 81800 ULU TIRAM, JOHOR.   81800 ULU TIRAM JOHOR BAHRU JOHOR",JOHOR,JOHOR BAHRU,10-Aug-22,10-Aug-25,3,0,23
CASA HIJAU SDN BHD,PAC/11002/2022/56753,591890W,"PANGSAPURI VILLAMAS , JALAN MUHIBBAH / KU3, KAMPUNG SUNGAI PINANG, 42100 KLANG KLANG SELANGOR",SELANGOR,KLANG,11-Aug-22,11-Aug-25,7,0,59
SHINRAI MANAGEMENT SDN BHD,PAC/11004/2022/58460,1300219U,SERI CEMPAKA   43650 BDR BARU BANGI HULU LANGAT SELANGOR,SELANGOR,HULU LANGAT,11-Aug-22,11-Aug-25,2,0,441
SHINRAI MANAGEMENT SDN BHD,PAC/11004/2022/58461,1300219U,SERI CEMPAKA   43650 BDR BARU BANGI HULU LANGAT SELANGOR,SELANGOR,HULU LANGAT,11-Aug-22,11-Aug-25,2,0,143
CASA HIJAU SDN BHD,PAC/11002/2022/59737,591890W,PANGSAPURI VILLAMAS JALAN MUHIBBAH /KU3 KAMPUNG SUNGAI PINANG 42100 KLANG KLANG SELANGOR,SELANGOR,KLANG,11-Aug-22,11-Aug-25,7,1,244
SHINRAI MANAGEMENT SDN BHD,PAC/11004/2022/61955,1300219U,"JALAN 1/9, SEKSYEN 1   43650 BDR BARU BANGI HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,11-Aug-22,11-Aug-25,9,1,38
Jom Mari Sdn Bhd,PAC/11002/2022/63474,2.01901E+11,"1-4-07, Block 1, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,9,0,127
Jom Mari Sdn Bhd,PAC/11002/2022/63475,2.01901E+11,"3-3-04, Block 3, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,5,0,197
Jom Mari Sdn Bhd,PAC/11002/2022/63476,2.01901E+11,"4-2-07, Block 4, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,2,1,77
Jom Mari Sdn Bhd,PAC/11002/2022/63477,2.01901E+11,"4-3-18, Block 4, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,3,0,173
Jom Mari Sdn Bhd,PAC/11002/2022/63478,2.01901E+11,"5-4-02, Block 5, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,3,0,15
Jom Mari Sdn Bhd,PAC/11002/2022/63479,2.01901E+11,"5-5-15, Block 5, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,11,0,148
Jom Mari Sdn Bhd,PAC/11002/2022/63480,2.01901E+11,"7-5-05, Block 7, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,3,0,211
Jom Mari Sdn Bhd,PAC/11002/2022/63481,2.01901E+11,"4-2-20, Block 4, Pangsapuri Sri Kemuning Jalan Anggerik Aranda 31/42 Kota Kemuning 40460 SHAH ALAM PETALING SELANGOR",SELANGOR,PETALING,11-Aug-22,11-Aug-25,1,1,68
Asahi Supplies & Services (M) Sdn Bhd,PAC/10501/2022/63953,406535A,"10179 & 10180, JALAN BBN 11/3B, 10304 & 10305 & 10319 & 10340 & 10354 JALAN BBN 11/3F, 10421 & 10425 & 10427, JALAN BBN 11/3P, 10273, JALAN BBN 11/3E, 10454, JALAN BBN 11/3R, 10342, JALAN BBN 11/4K, 10213, JALAN BBN 11/4B, 10188, JALAN BBN 11/4A, 10341, JALAN BBN 11/4J, 10403, JALAN BBN 11/3N, 10237, JALAN BBN 11/3D, DESA MELATI 71800 NILAI SEREMBAN NEGERI SEMBILAN",NEGERI SEMBILAN,SEREMBAN,12-Aug-22,12-Aug-25,1,1,29
MITRA UNIQUE SDN BHD,PAC/10401/2022/64034,1406625D,"BLOK B (BG-5, BG-7, BG-9, BG-11, B1-5, B1-6, B1-7, B1-8, B1-9, B1-10, B1-11, B1-12, B2-5, B2-6, B2-7, B2-8, B2-11, B3-5, B3-6, B3-7, B3-8, B3-12, B4-5, B4-6, B4-7, B4-8, B4-9, B4-10, B4-11, B4-12) PM NO. 800, MUKIM BERTAM, DAERAH MELAKA TENGAH, LOT 2294, DI ALAMAT RUMAH PANGSA BERTAM PERDANA, TAMAN BERTAM PERDANA, 75260 PULAU GADONG MELAKA 75260 MELAKA MELAKA TENGAH MELAKA",MELAKA,MELAKA TENGAH,12-Aug-22,12-Aug-25,10,4,104
APT JAYA SDN BHD,PAC/10401/2022/64475,1213236T,"NO L-3-12, BLOK L, PANGASAPURI TAMAN TASIK UTAMA AYER KEROH 75450 AYER KEROH MELAKA TENGAH MELAKA",MELAKA,MELAKA TENGAH,12-Aug-22,12-Aug-25,10,0,197
MIKHAN CORPORATION (M) SDN BHD,PAC/11401/2022/61884,842792T,"NO.1, JALAN 3/93A WARISAN CITYVIEW OFFBATU 2 1/2 JALAN CHERAS   56100 KUALA LUMPUR KUALA LUMPUR WP KUALA LUMPUR",WILAYAH PERSEKUTUAN KUALA LUMPUR,KUALA LUMPUR,17-Aug-22,17-Aug-25,0,1,176
MIKHAN CORPORATION (M) SDN BHD,PAC/11401/2022/61885,842792T,"NO.1, JALAN 3/93A WARISAN CITYVIEW OFF BATU 2 1/2 JALAN CHERAS   56100 KUALA LUMPUR KUALA LUMPUR WP KUALA LUMPUR",WILAYAH PERSEKUTUAN KUALA LUMPUR,KUALA LUMPUR,17-Aug-22,17-Aug-25,2,0,3
MANFORCE MANAGEMENT SDN BHD,PAC/10801/2022/61500,1339114X,"26, LALUAN MERU INDAH G6, GERBANG MERU INDAH  30020 IPOH KINTA PERAK",PERAK,KINTA,19-Aug-22,19-Aug-25,8,1,210
BLUESAND HOLDINGS SDN BHD,PAC/11001/2021/40949,1005652W,"NO 18, JALAN FAUNA 2A/8 , BANDAR RIMBAYU (FAUNA) , TELOK PANGLIMA GARANG , 42500 SELANGOR   42500 PETALING JAYA PETALING SELANGOR",SELANGOR,PETALING,25-Aug-22,25-Aug-25,3,0,32
KILAT JALUR SDN BHD,PAC/11002/2022/61497,731403T,JALAN SELAYANG SATU 27/2 Taman Bunga Negara SEKSYEN 27 40400 SHAH ALAM PETALING SELANGOR,SELANGOR,PETALING,25-Aug-22,25-Aug-25,0,0,2
LING HUI,PAC/10804/2022/64868,7.80318E+11,NO. 44 ATAS KEDAI JALAN KG SELAMAT TAMAN SELAMAT INDAH 32000 SITIAWAN MANJUNG(DINDING) PERAK,PERAK,MANJUNG(DINDING),25-Aug-22,25-Aug-25,1,1,60
KARYATAMA MITRA SEJATI SDN BHD,PAC/11004/2022/62081,510548K,Pangsapuri Sri Ayu Jalan 4/2A Seksyen 4  43650 BDR BARU BANGI HULU LANGAT SELANGOR,SELANGOR,HULU LANGAT,6-Sep-22,6-Sep-25,4,0,168
K A CONSTRUCTION SDN BHD,PAC/10401/2022/64351,972646A,"GMM 1049 LOT 1087 MUKIM SEMABOK, DAERAH MELAKA TENGAH 75050 MELAKA MELAKA TENGAH MELAKA",MELAKA,MELAKA TENGAH,7-Sep-22,7-Sep-25,15,0,35
Asahi Supplies & Services (M) Sdn Bhd,PAC/11004/2022/65630,406535A,"JALAN BERJAYA BARU 9, TAMAN BERJAYA BARU   43000 KAJANG HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,15-Sep-22,15-Sep-25,2,1,221
Asahi Supplies & Services (M) Sdn Bhd,PAC/11004/2022/65632,406535A,"PARCEL 2 SRI CAMELLIA APARTMENT, TAMAN SEPAKAT INDAH SUNGAI CHUA   43000 KAJANG HULU LANGAT SELANGOR",SELANGOR,HULU LANGAT,15-Sep-22,15-Sep-25,0,10,99

`;

// 2) CSV parser (handles quotes)
function parseCsvLine(line) {
  const out = [];
  let cur = "";
  let inQuotes = false;

  for (let i = 0; i < line.length; i++) {
    const ch = line[i];

    if (ch === '"') {
      if (inQuotes && line[i + 1] === '"') { cur += '"'; i++; }
      else inQuotes = !inQuotes;
    } else if (ch === "," && !inQuotes) {
      out.push(cur.trim()); cur = "";
    } else {
      cur += ch;
    }
  }
  out.push(cur.trim());
  return out;
}

function csvToObjects(csvText) {
  const lines = csvText.trim().split(/\r?\n/).filter(Boolean);
  const headers = parseCsvLine(lines[0]).map(h => h.trim());
  return lines.slice(1).map(line => {
    const cols = parseCsvLine(line);
    const obj = {};
    headers.forEach((h, i) => obj[h] = (cols[i] ?? "").trim());
    return obj;
  });
}

// 3) Demo: generate a risk score & risk level (replace later with real model)

function clamp01(x) { return Math.max(0, Math.min(1, x)); }

// Normalise to 0..1 (explainable)
function normComplaints(c) { return clamp01(c / 30); }        // 0..30+ complaints
function normViolations(v) { return clamp01(v / 6); }         // 0..6+ violations
function normDays(days)    { return clamp01(days / 720); }    // 0..720+ days

function calcRisk3(row) {
  const c = Number(row.complaints60d || 0);
  const v = Number(row.pastViolations || 0);
  const d = Number(row.daysSinceLastInspection || 0);

  // üö® Policy trigger rules (realistic for enforcement)
  if (v >= 6) return { score: 90, riskLevel: "High", triggerApplied: "Violations ‚â• 6" };
  if (v >= 3 && c >= 10) return { score: 85, riskLevel: "High", triggerApplied: "Violations ‚â• 3 & Complaints ‚â• 10" };
  if (v >= 3 && d >= 360) return { score: 80, riskLevel: "High", triggerApplied: "Violations ‚â• 3 & Days since last inspection ‚â• 360" };

  // Weighted score (ranking)
  const wC = 0.35, wV = 0.45, wD = 0.20;
  const s = (wC * normComplaints(c)) + (wV * normViolations(v)) + (wD * normDays(d));

  const score = Math.round(s * 100);
  const riskLevel = score >= 75 ? "High" : score >= 50 ? "Medium" : "Low";
  return { score, riskLevel, triggerApplied: null };
}


// 4) Build clqData from CSV (this replaces the hardcoded array)
const clqData = csvToObjects(registryCsv).map((r, idx) => {
  const { score, riskLevel,triggerApplied } = calcRisk3(r);

return {
  id: idx + 1,
  name: r.clqName || "-",
  employer: r.picName || "-",
  state: r.state || "-",
  complaints60d: Number(r.complaints60d || 0),
  pastViolations: Number(r.pastViolations || 0),
  daysSinceLastInspection: Number(r.daysSinceLastInspection || 0),
  riskScore: score,
  riskLevel: riskLevel,
  triggerApplied: triggerApplied,
  breakdown: [
    `Complaints (60d): ${Number(r.complaints60d || 0)}`,
    `Past violations: ${Number(r.pastViolations || 0)}`,
    `Days since last inspection: ${Number(r.daysSinceLastInspection || 0)}`,
	`Violation trigger applied: ${triggerApplied ? "Yes (" + triggerApplied + ")" : "No"}`
  ],
  signals: [],
  recommendation: riskLevel === "High"
    ? "Recommended to prioritise investigation within 30 days."
    : riskLevel === "Medium"
    ? "Monitor closely and schedule investigation if signals increase."
    : "Low-risk profile. Continue routine monitoring."
};
});
    
    function getRiskBadgeClass(level) {
      switch (level) {
        case "High":   return "bg-red-100 text-red-700";
        case "Medium": return "bg-orange-100 text-orange-700";
        case "Low":    return "bg-green-100 text-green-700";
        default:       return "bg-gray-200 text-gray-700";
      }
    }

    function renderSummary(data) {
      const total = data.length;
      const high = data.filter(d => d.riskLevel === "High").length;
      const totalComplaints = data.reduce((sum, d) => sum + d.complaints60d, 0);

      document.getElementById("cardTotalClq").textContent = total;
      document.getElementById("cardHighRisk").textContent = high;
      document.getElementById("cardComplaints").textContent = totalComplaints;
    }

    function renderDetail(clq) {
      document.getElementById("detailName").textContent = clq.name;
      document.getElementById("detailState").textContent = "State: " + clq.state;
      document.getElementById("detailRiskScore").textContent = "Risk Score: " + clq.riskScore + " / 100";

      const badge = document.getElementById("detailRiskBadge");
      badge.textContent = clq.riskLevel.toUpperCase() + " RISK";
      badge.className = "inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold " + getRiskBadgeClass(clq.riskLevel);

      const breakdownList = document.getElementById("detailBreakdown");
      breakdownList.innerHTML = "";
      clq.breakdown.forEach(item => {
        const li = document.createElement("li");
        li.textContent = "‚Ä¢ " + item;
        breakdownList.appendChild(li);
      });

      const signalsList = document.getElementById("detailSignals");
      signalsList.innerHTML = "";
      clq.signals.forEach(sig => {
        const li = document.createElement("li");
        li.textContent = "‚Ä¢ " + sig;
        signalsList.appendChild(li);
      });

      document.getElementById("detailRecommendation").textContent = clq.recommendation;
    }

	function updatePagingUI(totalItems) {
	  const totalPages = Math.max(1, Math.ceil(totalItems / pageSize));
	  currentPage = Math.min(currentPage, totalPages);

	  const start = (currentPage - 1) * pageSize + 1;
	  const end = Math.min(totalItems, currentPage * pageSize);

	  document.getElementById("pagingInfo").textContent =
		`Showing ${totalItems === 0 ? 0 : start} to ${end} of ${totalItems}`;

	  document.getElementById("btnPrev").disabled = (currentPage <= 1);
	  document.getElementById("btnNext").disabled = (currentPage >= totalPages);
	}

	function renderTablePaged(data) {
	  const tbody = document.getElementById("clqTableBody"); // pastikan id ni sama
	  tbody.innerHTML = "";

	  const totalItems = data.length;
	  updatePagingUI(totalItems);

	  const startIdx = (currentPage - 1) * pageSize;
	  const pageItems = data.slice(startIdx, startIdx + pageSize);

	  pageItems.forEach((clq, index) => {
		const rowNo = startIdx + index + 1;

		const tr = document.createElement("tr");
		tr.className = "hover:bg-gray-50";

		tr.innerHTML = `
		  <td class="px-3 py-2 text-left text-gray-500">${rowNo}</td>
		  <td class="px-3 py-2 text-left">
			<p class="font-medium text-gray-800">${clq.name}</p>
		  </td>
		  <td class="px-3 py-2 text-left text-gray-600">${clq.state}</td>
		  <td class="px-3 py-2 text-right font-semibold text-gray-800">${clq.riskScore}</td>
		  <td class="px-3 py-2 text-center">
			<span class="inline-flex px-2 py-0.5 rounded-full text-[10px] font-semibold ${getRiskBadgeClass(clq.riskLevel)}">
			  ${clq.riskLevel.toUpperCase()}
			</span>
		  </td>
		  <td class="px-3 py-2 text-center text-gray-700">${clq.complaints60d ?? 0}</td>
		  <td class="px-3 py-2 text-center">
			<button class="text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700"
			  data-id="${clq.id}">
			  View
			</button>
		  </td>
		`;
		tbody.appendChild(tr);
	  });

	  // re-bind view buttons
	  tbody.querySelectorAll("button[data-id]").forEach(btn => {
		btn.addEventListener("click", () => {
		  const id = Number(btn.getAttribute("data-id"));
		  const selected = currentView.find(c => c.id === id);
		  if (selected) renderDetail(selected);
		});
	  });
	}


    function resetDetail() {
      document.getElementById("detailName").textContent = "-";
      //document.getElementById("detailEmployer").textContent = "Operator/Employer: -";
      document.getElementById("detailState").textContent = "State: -";
      document.getElementById("detailRiskScore").textContent = "Risk Score: -";

      document.getElementById("detailBreakdown").innerHTML = "<li>-</li>";
      document.getElementById("detailSignals").innerHTML = "<li>-</li>";
      document.getElementById("detailRecommendation").textContent = "-";

      const badge = document.getElementById("detailRiskBadge");
      badge.textContent = "RISK LEVEL";
      badge.className = "inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-gray-200 text-gray-700";
    }

    function applyFilter() {
      const state = document.getElementById("filterState").value;
      const risk  = document.getElementById("filterRisk").value;

      let filtered = [...clqData];
      if (state) filtered = filtered.filter(c => c.state === state);
      if (risk)  filtered = filtered.filter(c => c.riskLevel === risk);

      renderSummary(filtered);
      renderTable(filtered);
      resetDetail();
	  currentPage = 1;
	  currentView = filtered.sort((a, b) => b.riskScore - a.riskScore);
	  renderTablePaged(currentView);	  
    }

	let currentPage = 1;
	let pageSize = 10;
	let currentView = [];

	document.addEventListener("DOMContentLoaded", () => {
	  // initial view
	  currentView = [...clqData].sort((a, b) => b.riskScore - a.riskScore);

	  renderSummary(currentView);
	  renderTablePaged(currentView);
	  resetDetail();

	  document.getElementById("btnApplyFilter").addEventListener("click", applyFilter);

	  document.getElementById("btnPrev").addEventListener("click", () => {
		if (currentPage > 1) {
		  currentPage--;
		  renderTablePaged(currentView);
		}
	  });

	  document.getElementById("btnNext").addEventListener("click", () => {
		const totalPages = Math.max(1, Math.ceil(currentView.length / pageSize));
		if (currentPage < totalPages) {
		  currentPage++;
		  renderTablePaged(currentView);
		}
	  });

	  document.getElementById("pageSize").addEventListener("change", (e) => {
		pageSize = Number(e.target.value);
		currentPage = 1;
		renderTablePaged(currentView);
	  });
	});


  </script>
</body>
</html>
