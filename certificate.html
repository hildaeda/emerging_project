<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Act 446 Compliance Certificate (Prototype)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-4xl mx-auto">
    <!-- Certificate Sheet -->
    <div class="bg-white shadow-xl rounded-2xl overflow-hidden border border-gray-200">
      <!-- Top Bar -->
      <div class="flex items-start justify-between p-6 border-b bg-gradient-to-r from-amber-50 to-white">
        <div class="flex items-center gap-4">
          <!-- Replace with Jata Negara / JTKSM logo -->
          <img src="./jata-negara.png" alt="Coat of Arms" class="h-14 w-14 object-contain" />
          <div>
            <p class="text-xs text-gray-500">Jabatan Tenaga Kerja Semenanjung Malaysia (JTKSM)</p>
            <h1 class="text-xl font-semibold tracking-tight text-gray-900">Act 446 Compliance Certificate</h1>
            <p class="text-xs text-gray-500 mt-1">Workers’ Minimum Standards of Housing, Accommodations and Amenities</p>
          </div>
        </div>

        <!-- Blockchain Block (top-right) -->
        <div class="w-72 border rounded-xl bg-white p-3">
          <p class="text-xs font-semibold text-gray-700">Blockchain Reference (Prototype)</p>
          <div class="mt-2 space-y-1 text-xs text-gray-700">
            <div class="flex justify-between gap-3">
              <span class="text-gray-500">Blockchain ID</span>
              <span class="font-mono" id="bcId">-</span>
            </div>
            <div class="flex justify-between gap-3">
              <span class="text-gray-500">Hash</span>
              <span class="font-mono break-all text-right" id="bcHash">-</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Badge / Title -->
      <div class="px-6 pt-6">
        <div class="flex items-center gap-4">
          <img src="./gold-compliance-2.png" alt="Compliance Badge" class="h-20 w-14 object-contain" />
          <div>
            <p class="text-xs text-gray-500">Certificate Status</p>
            <p class="text-lg font-semibold text-gray-900">Verified Compliance</p>
            <p class="text-xs text-gray-500 mt-1">
              Issued for demonstration purposes only. Final validity is subject to JTKSM verification.
            </p>
          </div>
        </div>
      </div>

      <!-- Main Details -->
      <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="border rounded-xl p-4">
          <p class="text-xs text-gray-500">Company / Employer</p>
          <p class="text-lg font-semibold text-gray-900" id="companyName">UNIVERSAL BEST SDN BHD</p>
          <p class="text-xs text-gray-500 mt-2">CLQ / Accommodation Centre</p>
          <p class="text-sm text-gray-800" id="clqName">CENTRALISED LABOUR QUARTERS (CLQ)</p>
        </div>

        <div class="border rounded-xl p-4">
          <p class="text-xs text-gray-500">Certificate / Registration</p>
          <div class="mt-2 grid grid-cols-2 gap-3 text-sm">
            <div>
              <p class="text-xs text-gray-500">PAC No.</p>
              <p class="font-semibold text-gray-900" id="pacNo">PAC/11004/2022/62394</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Issue Date</p>
              <p class="font-semibold text-gray-900" id="issueDate">2025-12-15</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Valid From</p>
              <p class="font-semibold text-gray-900" id="validFrom">2025-12-15</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Valid Until</p>
              <p class="font-semibold text-gray-900" id="validUntil">2028-12-14</p>
            </div>
          </div>
        </div>

        <div class="md:col-span-2 border rounded-xl p-4">
          <p class="text-xs text-gray-500">Premises Address</p>
          <p class="text-sm text-gray-900" id="address">
            503, BLOK 1, JALAN 6C/11, 43650 BANDAR BARU BANGI, HULU LANGAT, SELANGOR
          </p>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="border rounded-lg p-3 bg-gray-50">
              <p class="text-xs text-gray-500">State</p>
              <p class="text-sm font-semibold text-gray-900" id="state">SELANGOR</p>
            </div>
            <div class="border rounded-lg p-3 bg-gray-50">
              <p class="text-xs text-gray-500">Compliance Tier</p>
              <p class="text-sm font-semibold text-gray-900" id="tier">GREEN – VERIFIED</p>
            </div>
            <div class="border rounded-lg p-3 bg-gray-50">
              <p class="text-xs text-gray-500">Reference</p>
              <p class="text-sm font-mono text-gray-900" id="ref">JTKSM/CLQ/PROTO/2025</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Signature -->
      <div class="px-6 pb-6">
        <div class="border-t pt-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
          <div>
            <p class="text-xs text-gray-500">Issued by</p>
            <p class="text-sm font-semibold text-gray-900">Jabatan Tenaga Kerja Semenanjung Malaysia (JTKSM)</p>
            <p class="text-xs text-gray-500 mt-1">This certificate is generated by a prototype system for demonstration.</p>
          </div>

          <div class="text-right">
            <div class="inline-block text-left">
              <div class="h-14 border-b border-gray-400 w-64"></div>
              <p class="text-xs text-gray-500 mt-2">Signature</p>
              <p class="text-sm font-semibold text-gray-900">Ketua Pengarah JTKSM</p>
              <p class="text-xs text-gray-500">Official Seal / Digital Signature</p>
            </div>
          </div>
        </div>

        <!-- Small footer -->
        <p class="text-[11px] text-gray-500 mt-6">
          Note: Blockchain reference shown is a prototype hash for integrity demonstration only (not an official on-chain record).
        </p>
      </div>
    </div>

    <!-- Controls (optional, for demo) -->
    <div class="mt-4 text-xs text-gray-600">
      Tip: You can pass values via URL like
      <span class="font-mono">?company=ABC%20SDN%20BHD&pac=PAC/123&issue=2025-12-15&from=2025-12-15&until=2028-12-14</span>
    </div>
  </div>

  <script>
    // --- Helpers ---
    function $(id) { return document.getElementById(id); }

    function getParam(key, fallback = "") {
      const url = new URL(window.location.href);
      return url.searchParams.get(key) || fallback;
    }

    function normalizeDate(s) {
      // Expect YYYY-MM-DD, keep as-is if valid-ish
      return (s && /^\d{4}-\d{2}-\d{2}$/.test(s)) ? s : s;
    }

    async function sha256Hex(text) {
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // --- Load data (from URL params OR defaults) ---
    const data = {
      companyName: getParam("company", $("companyName").textContent),
      clqName: getParam("clq", $("clqName").textContent),
      pacNo: getParam("pac", $("pacNo").textContent),
      issueDate: normalizeDate(getParam("issue", $("issueDate").textContent)),
      validFrom: normalizeDate(getParam("from", $("validFrom").textContent)),
      validUntil: normalizeDate(getParam("until", $("validUntil").textContent)),
      address: getParam("address", $("address").textContent),
      state: getParam("state", $("state").textContent),
      tier: getParam("tier", $("tier").textContent),
      ref: getParam("ref", $("ref").textContent),
    };

    // --- Render fields ---
    $("companyName").textContent = data.companyName;
    $("clqName").textContent = data.clqName;
    $("pacNo").textContent = data.pacNo;
    $("issueDate").textContent = data.issueDate;
    $("validFrom").textContent = data.validFrom;
    $("validUntil").textContent = data.validUntil;
    $("address").textContent = data.address;
    $("state").textContent = data.state;
    $("tier").textContent = data.tier;
    $("ref").textContent = data.ref;

    // --- Blockchain ID + Hash (as you requested) ---
    // Blockchain ID = PAC + IssueDate
    const blockchainId = `${data.pacNo}+${data.issueDate}`;
    $("bcId").textContent = blockchainId;

    // Hash = SHA256(data)
    // Define "data" string consistently (so hash is reproducible)
    const canonical = [
      `company=${data.companyName}`,
      `clq=${data.clqName}`,
      `pac=${data.pacNo}`,
      `issue=${data.issueDate}`,
      `from=${data.validFrom}`,
      `until=${data.validUntil}`,
      `address=${data.address}`,
      `state=${data.state}`,
      `tier=${data.tier}`,
      `ref=${data.ref}`,
      `blockchainId=${blockchainId}`
    ].join("|");

    (async () => {
      const hash = await sha256Hex(canonical);
      $("bcHash").textContent = hash;
    })();
  </script>
</body>
</html>
